<div class="container col-lg-12"> 
  <%= form_with(model: capital_account, local: true) do |form| %>
    <% if capital_account.errors.any? %>
      <div id="error_explanation">
        <h2><%= pluralize(capital_account.errors.count, "error") %> prohibited this capital_account from being saved:</h2>
        <ul>
          <% capital_account.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>
    <div class="form-group">  

      <div class="field">
        <%= form.label :investor %>
        <%= form.select :user_id, User.all.collect { |x| [ "#{x.first_name} #{x.last_name}", x.id] }, { hide_label: true, :include_blank => "-select investor-"  }, { class: 'selectpicker form-control blue', "data-live-search" => :true, :autofocus => :true } %>
      </div>

      <div class="field">
        <%= form.label :initial_balance %>
        <%= form.number_field :initial_balance, class: 'form-control' %>
      </div>

      <div class="field">
        <%= form.label :current_balance %>
        <%= form.number_field :current_balance, class: 'form-control' %>
      </div>
      
      <div class="field">
        <%= form.label :deal %>
          <%= form.select :deal_id, Deal.all.collect { |x| [ "#{x.name}", x.id] }, { hide_label: true, :include_blank => "-select deal-"  }, { class: 'selectpicker form-control blue', "data-live-search" => :true, :autofocus => :true } %>
      </div>

      <h4>Distributions</h4>
      <div data-controller="nested-form">
        <template data-target="nested-form.template">
          <%= form.fields_for :capital_distributions, CapitalDistribution.new, child_index: 'NEW_RECORD' do |capital_distribution|  %>
            <%= render "capital_distribution_fields", form: capital_distribution %>
          <% end %>
        </template>

        <%= form.fields_for :capital_distributions do |capital_distribution| %>
          <%= render "capital_distribution_fields", form: capital_distribution %>
        <% end %>

        <div class="my-3" data-target="nested-form.links">  
          <%= link_to "Add Distribution", "#", class: 'btn btn-outline-primary', data: { action: "click->nested-form#add_association" } %>
        </div>
      </div>
      

      <div class="form-group"></div>
      <div class="actions">
        <%= link_to 'Back', capital_accounts_path, class: 'btn btn-secondary text-white' %>
        <%= form.submit class: 'btn btn-primary' %>
      </div>
    </div>
  <% end %>
</div>